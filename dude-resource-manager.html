<!--
Copyright (c) 2015 DudeTeam. All rights reserved.
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../dude-hierarchy/dude-hierarchy.html">
<!--
`dude-resource-manager` is an audio and image resource manager.

@group dude Elements
@element dude-resource-manager
@demo demo/index.html
-->
<dom-module id="dude-resource-manager">
    <style include="iron-flex iron-flex-factors"></style>
    <style>
        #container {
            min-height: 256px;
            border: 1px solid;
        }

        #left-panel {
            max-width: 256px;
        }

        #right-panel {

        }
        
        #preview > img {
            max-width: 100%;
            max-height: 256px;
            overflow: hidden;
        }
    </style>
    <template>
        <div id="container" class="layout horizontal">
            <!-- START Left Panel -->
            <div id="left-panel" class="flex" style="border: 1px solid;">
                <div class="layout vertical">
                    <div class="flex">
                        <div id="preview">
                            <img src="{{ resource.data.file_name }}" />
                        </div>
                    </div>
                    <div class="flex">
                        <div>[[ resource.name ]]</div>
                        <div>[[ resourceSize ]]</div>
                    </div>
                </div>
            </div>
            <!-- END Left Panel -->
            <!-- START Right Panel -->
            <div id="right-panel" class="flex-2" style="border: 1px solid;">
                <div class="layout vertical">
                    <dude-hierarchy
                            id="resources-hierarchy"
                            class="flex"
                            items="[[ resources ]]"
                            placeholder="Search resource">
                    </dude-hierarchy>
                </div>
            </div>
            <!-- END Right Panel -->
        </div>
    </template>
    <script>
        Polymer({
            is: "dude-resource-manager",
            properties: {
                /**
                 * The resources
                 */
                "resources": {
                    "type": Array
                },

                /**
                 * The resource selected
                 */
                "resource": {
                    "type": Object
                },

                /**
                 * Computed property to return the human readable size
                 */
                "resourceSize": {
                    "type": String,
                    "computed": "_formatSize(resource.data.size)"
                }
            },
            listeners: {
                "dude-hierarchy-item-select": "_itemSelected",
                "dude-hierarchy-item-submit": "_itemSubmitted"
            },

            /**
             * Called when an item is selected
             * Updates the preview
             * @private
             */
            _itemSelected: function (e) {
                if (e.detail) {
                    this.set("resource", e.detail.item);
                }
            },

            /**
             * Submits the selected item
             * @param {CustomEvent} e
             * @private
             */
            _itemSubmitted: function (e) {
                if (e.detail.item) {
                    this.fire("dude-resource-manager-submit", e.detail.item);
                }
            },

            /**
             * Formats to human readable string
             * @param {Number} size
             * @returns {String}
             * @private
             */
            _formatSize: function (size) {
                var i = Math.floor(Math.log(size) / Math.log(1024));
                return (size / Math.pow(1024, i)).toFixed(2) * 1 + ' ' + ['B', 'kB', 'MB', 'GB', 'TB'][i];
            }
        });
    </script>
</dom-module>