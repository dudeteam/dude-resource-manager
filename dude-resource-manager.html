<!--
Copyright (c) 2015 DudeTeam. All rights reserved.
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../dude-hierarchy/dude-hierarchy.html">
<!--
`dude-resource-manager` is an audio and image resource manager.

@group dude Elements
@element dude-resource-manager
@demo demo/index.html
-->
<dom-module id="dude-resource-manager">
    <style include="iron-flex iron-flex-factors"></style>
    <template>
        <div class="layout vertical">
            <!-- START Top -->
            <div class="flex">
                <dude-hierarchy
                        id="resources-hierarchy"
                        items="[[ resources ]]"
                        placeholder="Search resource">
                </dude-hierarchy>
                <button on-click="_uploadResource">Upload</button>
            </div>
            <!-- END Top -->
            <!-- START Bottom -->
            <div class="flex">
                <template is="dom-if" if="[[ resource ]]">
                    <div>Name: <span>[[ resource.name ]]</span></div>
                    <div>Size: <span>[[ resourceSize ]]</span></div>
                    <div><img src="[[ resource.data.file_name ]]" /></div>
                    <button on-click="_deleteResource">Delete</button>
                </template>
            </div>
            <!-- END Bottom -->
        </div>
    </template>
    <script>
        Polymer({
            is: "dude-resource-manager",
            properties: {
                /**
                 * The resources
                 */
                "resources": {
                    "type": Array
                },

                /**
                 * The resource selected
                 */
                "resource": {
                    "type": Object,
                    "notify": true
                },

                /**
                 * Computed property to return the human readable size
                 */
                "resourceSize": {
                    "type": String,
                    "computed": "_formatSize(resource.data.size)"
                }
            },
            listeners: {
                "dude-hierarchy-item-select": "_itemSelected",
                "dude-hierarchy-item-submit": "_itemSubmitted"
            },

            /**
             * Called when an item is selected
             * Updates the preview
             * @private
             */
            _itemSelected: function (e) {
                if (e.detail) {
                    this.set("resource", e.detail.item);
                }
            },

            /**
             * Submits the selected item
             * @param {CustomEvent} e
             * @private
             */
            _itemSubmitted: function (e) {
                if (e.detail.item) {
                    this.fire("dude-resource-manager-submit", e.detail.item);
                }
            },

            /**
             * Formats to human readable string
             * @param {Number} size
             * @returns {String}
             * @private
             */
            _formatSize: function (size) {
                var i = Math.floor(Math.log(size) / Math.log(1024));
                return (size / Math.pow(1024, i)).toFixed(2) * 1 + ' ' + ['B', 'kB', 'MB', 'GB', 'TB'][i];
            },

            /**
             * Called when uploading a resource
             * @emits {dude-resource-manager-upload}
             * @private
             */
            _uploadResource: function () {
                this.fire("dude-resource-manager-upload");
            },

            /**
             * Called when uploading a resource
             * @emits {dude-resource-manager-rename}
             * @private
             */
            _renameResource: function () {
                this.fire("dude-resource-manager-rename", this.get("resource"));
            },

            /**
             * Called when deleting a resource
             * @emits {dude-resource-manager-delete}
             * @private
             */
            _deleteResource: function () {
                this.fire("dude-resource-manager-delete", this.get("resource"));
            }
        });
    </script>
</dom-module>